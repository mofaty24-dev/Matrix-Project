<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css">
    <title>MatrixProject (browser)</title>

</head>

<body>
    <h1>Matrix Solver — Gauss-Jordan Elimination</h1>
    <h5> click on each step encrementally form step 1 to step 6 after displaying the matrix and if special condition
        occurs the step will tell you
        which button to click to fix it </h5>

    <div class="controls">
        <label>Rows: <input id="rows" type="number" min="1" value="3"></label>
        <label>Cols: <input id="cols" type="number" min="1" value="4"></label>
        <button id="createBtn" class="btn">Create matrix inputs</button>
        <button id="displayBtn" class="btn">Display matrix</button>
        <button id="stepOneBtn" class="btn">Step 1 (determining The First Un-zero Column)</button>
        <!-- existing behavior -->
        <button id="step1Btn" class="btn">Step 2(first Element Check)</button> <!-- check first element only -->
        <button id="step3Btn" class="btn">Step 3 (swap first row with any row starts with any num but zero
            )<!-- Add this button in the HTML controls section -->
            <button id="step4Btn" class="btn">Step 4 (scale first row by inverse of a₁₁)</button>
            <button id="step5Btn" class="btn">Step 5 (zero out first column below the leading)</button>
            <button id="step6Btn" class="btn">Step 6 (apply steps 2–5 to a₂₂)</button>
            <button id="jordanBtn" class="step-button" onclick="JordanElimination()">Jordan Elimination (the Final Step:
                zero out
                the matrix except the last column and the leadings)</button>
    </div>
    <div id="inputsArea"></div>
    <div id="displayArea"></div>
    <div id="verificationArea"></div>
    <div id="messages" class="msg"></div>
    <button id="verifyBtn" class="btn">Verify Matrix</button>
    <button id="solutionBtn" class="btn">Get the number of solutions</button>
    <button id="solveBtn" class="btn">Get x, y, z</button>
    <script>
        function zeroOutFirstColumn() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) {
                showMessage('Matrix is empty or malformed');
                return;
            }

            const rows = matrix.length;
            const cols = matrix[0].length;
            const a22 = matrix[1][1];
            const a12 = matrix[0][1];

            // New condition: if a22 == 0
            if (a22 === 0) {
                if (a12 === 0) {
                    showMessage("a22 is equal to 0 go to step 3 to swap rows");
                    return;
                } else {
                    // Multiply inverse of a12 to row 1 and add to row 2
                    const factor = 1 / a12;
                    for (let c = 0; c < cols; c++) {
                        matrix[1][c] += factor * matrix[0][c];
                    }

                    for (let i = 0; i < rows; i++) {
                        for (let j = 0; j < cols; j++) {
                            const inp = document.getElementById(`elem_${i}_${j}`);
                            if (inp) inp.value = matrix[i][j];
                        }
                    }

                    displayMatrixInteractive();
                    showMessage(`a22 was zero. Added (1/${a12}) × Row 1 to Row 2`);
                    return;
                }
            }

            // Original logic: zero out first column below pivot
            const pivot = matrix[0][0];
            if (pivot === 0) {
                showMessage("the leading (a₁₁) is zero. Cannot proceed with elimination.");
                return;
            }

            let actions = [];

            for (let r = 1; r < rows; r++) {
                const target = matrix[r][0];
                if (target === 0) continue;

                const factor = -target;
                for (let c = 0; c < cols; c++) {
                    matrix[r][c] += factor * matrix[0][c];
                }

                actions.push(`Row ${r + 1} updated: added (${factor}) × Row 1 to it`);
            }

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }

            displayMatrixInteractive();
            showMessage(actions.length ? actions.join('\n') : "No changes needed. First column already zeroed below leading.");
        }
        function solveXYZ() {
            clearMessages();
            if (!matrix || matrix.length !== 3 || matrix[0].length !== 4) {
                showMessage('Matrix must be 3×4 (augmented) to solve for x, y, z');
                return;
            }
            // Back-substitution
            const [row1, row2, row3] = matrix;
            const z = row3[3] / row3[2];
            const y = (row2[3] - row2[2] * z) / row2[1];
            const x = (row1[3] - row1[2] * z - row1[1] * y) / row1[0];
            if (
                !Number.isFinite(x) ||
                !Number.isFinite(y) ||
                !Number.isFinite(z)
            ) {
                showMessage('Cannot solve: matrix may not be in row-echelon form or has invalid values');
                return;
            }
            showMessage(`Solution found:\n x = ${x.toFixed(3)}\n y = ${y.toFixed(3)}\n z = ${z.toFixed(3)}`);
        }
        document.getElementById('solveBtn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                solveXYZ();
            } catch (e) {
                showMessage(e.message);
            }
        });
        function analyzeSolutionCount() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) {
                showMessage('Matrix is empty or malformed');
                return;
            }
            const lastRow = matrix[matrix.length - 1];
            const lastColIndex = lastRow.length - 1;
            const allZero = lastRow.every(val => val === 0);
            const restZero = lastRow.slice(0, lastColIndex).every(val => val === 0);
            const lastVal = lastRow[lastColIndex];
            if (allZero) {
                showMessage("The equation has infinitely many solutions");
            } else if (restZero && lastVal !== 0) {
                showMessage("The equation has no solution");
            } else {
                showMessage("The equation has one solution");
            }
        }
        document.getElementById('solutionBtn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                analyzeSolutionCount();
            } catch (e) {
                showMessage(e.message);
            }
        });
        function step6ProcessA22() {
            clearMessages();
            if (!matrix || matrix.length < 2 || matrix[0].length < 2) {
                showMessage('Matrix must be at least 2×2 to process a₂₂');
                return;
            }
            const pivot = matrix[1][1];
            // Step 2: Check if a₂₂ is zero
            if (pivot === 0) {
                // Step 3: Try to swap row 2 with a lower row that has non-zero in column 2
                let swapped = false;
                for (let r = 2; r < matrix.length; r++) {
                    if (matrix[r][1] !== 0) {
                        for (let c = 0; c < matrix[0].length; c++) {
                            const temp = matrix[1][c];
                            matrix[1][c] = matrix[r][c];
                            matrix[r][c] = temp;
                        }
                        showMessage(`Row 2 swapped with row ${r + 1} to get non-zero a₂₂`);
                        swapped = true;
                        break;
                    }
                }
                if (!swapped) {
                    showMessage('No suitable row found to swap with row 2 for non-zero a₂₂');
                    return;
                }
            }
            // Refresh pivot after possible swap
            const newPivot = matrix[1][1];
            if (newPivot === 0) {
                showMessage('a₂₂ is still zero after swap. Cannot proceed.');
                return;
            }
            // Step 4: Scale row 2 by inverse of a₂₂
            for (let c = 0; c < matrix[0].length; c++) {
                matrix[1][c] = matrix[1][c] / newPivot;
            }

            // Step 5: Zero out column 2 below row 2
            for (let r = 2; r < matrix.length; r++) {
                const factor = -matrix[r][1];
                for (let c = 0; c < matrix[0].length; c++) {
                    matrix[r][c] += factor * matrix[1][c];
                }
            }

            // Update input fields
            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[i].length; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }

            displayMatrixInteractive();
            showMessage('Step 6 completed: processed a₂₂ through steps 2-5');
        }

        document.getElementById('step6Btn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                step6ProcessA22();
            } catch (e) {
                showMessage(e.message);
            }
        });

        // matrix in memory
        let matrix = [];
        // ---- Step 4: scale first row by inverse of a₁₁ ----
        function zeroOutFirstColumn() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) {
                showMessage('Matrix is empty or malformed');
                return;
            }

            const rows = matrix.length;
            const cols = matrix[0].length;
            const leading = matrix[0][0];

            if (leading === 0) {
                showMessage("the leading (a₁₁) is zero. Cannot proceed with elimination.");
                return;
            }

            let actions = [];

            for (let r = 1; r < rows; r++) {
                const target = matrix[r][0];
                if (target === 0) continue;

                const factor = -target; // additive inverse
                for (let c = 0; c < cols; c++) {
                    matrix[r][c] += factor * matrix[0][c];
                }

                actions.push(`Row ${r + 1} updated: added (${factor}) × Row 1 to it \n`);

            }

            // Update input fields if present
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }

            displayMatrixInteractive();
            showMessage(actions.length ? actions.join('\n') : "No changes needed. First column already zeroed below leading.");
        }



        // Attach event listener for Step 5 button
        document.getElementById('step5Btn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                zeroOutFirstColumn();
            } catch (e) {
                showMessage(e.message);
            }
        });


        // Attach event listener for Step 4 button
        document.getElementById('step4Btn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                scaleFirstRowByInverse();
            } catch (e) {
                showMessage(e.message);
            }
        });


        function clearMessages() { document.getElementById('messages').textContent = ''; }
        function showMessage(m) { document.getElementById('messages').textContent = m; }

        document.getElementById('createBtn').addEventListener('click', () => {
            clearMessages();
            const rows = parseInt(document.getElementById('rows').value, 10) || 0;
            const cols = parseInt(document.getElementById('cols').value, 10) || 0;
            if (rows < 1 || cols < 1) { showMessage('Rows and columns must be positive integers'); return; }
            const area = document.getElementById('inputsArea');
            area.innerHTML = '';
            const table = document.createElement('table');
            const tbody = document.createElement('tbody');
            for (let i = 0; i < rows; i++) {
                const tr = document.createElement('tr');
                for (let j = 0; j < cols; j++) {
                    const td = document.createElement('td');
                    const inp = document.createElement('input');
                    inp.type = 'number';
                    inp.id = `elem_${i}_${j}`;
                    inp.value = 0;
                    td.appendChild(inp);
                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            }
            table.appendChild(tbody);
            area.appendChild(table);

            // reset displayed matrix and in-memory matrix
            matrix = Array.from({ length: rows }, () => Array(cols).fill(0));
            document.getElementById('displayArea').innerHTML = '';
            document.getElementById('verificationArea').innerHTML = '';
        });

        function readMatrixFromInputs() {
            const rows = parseInt(document.getElementById('rows').value, 10) || 0;
            const cols = parseInt(document.getElementById('cols').value, 10) || 0;
            if (rows < 1 || cols < 1) { throw new Error('Invalid rows/cols'); }
            const newM = [];
            for (let i = 0; i < rows; i++) {
                const row = [];
                for (let j = 0; j < cols; j++) {
                    const el = document.getElementById(`elem_${i}_${j}`);
                    if (!el) throw new Error('Matrix input grid missing; click "Create matrix inputs"');
                    const v = Number(el.value);
                    if (!Number.isFinite(v)) throw new Error('All elements must be numbers');
                    row.push(v);
                }
                newM.push(row);
            }
            matrix = newM;
            return matrix;
        }

        function displayMatrixInteractive() {
            clearMessages();
            if (!matrix || !matrix.length) { showMessage('No matrix in memory. Create inputs and click Display.'); return; }
            const area = document.getElementById('displayArea');
            area.innerHTML = '<h3>Matrix</h3>';
            const table = document.createElement('table');
            const tbody = document.createElement('tbody');
            for (let i = 0; i < matrix.length; i++) {
                const tr = document.createElement('tr');
                for (let j = 0; j < matrix[i].length; j++) {
                    const td = document.createElement('td');
                    td.textContent = matrix[i][j];
                    td.className = 'clickable';
                    td.title = 'Click to edit this value';
                    td.addEventListener('click', () => {
                        const newValRaw = prompt(`Enter new integer value for element (${i + 1},${j + 1}):`, String(matrix[i][j]));
                        if (newValRaw === null) return;
                        const newVal = Number(newValRaw);
                        if (!Number.isFinite(newVal)) { alert('Please enter a valid number'); return; }
                        matrix[i][j] = newVal;
                        // also update input grid if present
                        const inp = document.getElementById(`elem_${i}_${j}`);
                        if (inp) inp.value = newVal;
                        displayMatrixInteractive();
                        renderVerificationPrompt();
                    });
                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            }
            table.appendChild(tbody);
            area.appendChild(table);
        }

        document.getElementById('displayBtn').addEventListener('click', () => {
            try {
                readMatrixFromInputs();
                displayMatrixInteractive();
            } catch (e) {
                showMessage(e.message);
            }
        });

        // Verification UI: shows the matrix and asks yes/no
        function renderVerificationPrompt() {
            clearMessages();
            const vArea = document.getElementById('verificationArea');
            vArea.innerHTML = '';
            if (!matrix || !matrix.length) return;
            const p = document.createElement('p');
            p.textContent = 'So this is the matrix you just entered. Are you sure this is the matrix you want to solve?';
            vArea.appendChild(p);
            const yesBtn = document.createElement('button');
            yesBtn.textContent = 'Yes';
            yesBtn.addEventListener('click', () => {
                // show message for starting step one
                showMessage("ok let's start step one");
            });
            const noBtn = document.createElement('button');
            noBtn.textContent = 'No (edit element)';
            noBtn.addEventListener('click', () => {
                alert('Click any cell in the displayed matrix to edit it.');
            });
            vArea.appendChild(yesBtn);
            vArea.appendChild(noBtn);
        }

        document.getElementById('verifyBtn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                displayMatrixInteractive();
                renderVerificationPrompt();
            } catch (e) {
                showMessage(e.message);
            }
        });

        // ---- Step 1: check first element only (do not swap) ----
        function checkFirstElement() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) { showMessage('Matrix is empty or malformed'); return; }
            if (matrix[0][0] === 0) {
                showMessage("first element can't be equal to zero so we'll go to step 3");
            } else {
                showMessage("first element isn't equal to zero so we'll skip step 3 and go to step 4");
            }
        }

        // ---- Step 3: perform swap rows task ----
        function swapRowsStep3() {
            // New condition: if a22 == 0, swap row 2 with row 3
            if (matrix.length >= 3 && matrix[1][1] === 0) {
                const temp = matrix[1];
                matrix[1] = matrix[2];
                matrix[2] = temp;

                showMessage("a22 was zero. Row 2 has been swapped with Row 3");

                for (let i = 0; i < matrix.length; i++) {
                    for (let j = 0; j < matrix[i].length; j++) {
                        const inp = document.getElementById(`elem_${i}_${j}`);
                        if (inp) inp.value = matrix[i][j];
                    }
                }
                displayMatrixInteractive();
                return;

            }
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) { showMessage('Matrix is empty or malformed'); return; }
            const rows = matrix.length;
            for (let r = 1; r < rows; r++) {
                if (matrix[r][0] !== 0) {
                    // swap rows 0 and r
                    for (let c = 0; c < matrix[0].length; c++) {
                        const tmp = matrix[0][c];
                        matrix[0][c] = matrix[r][c];
                        matrix[r][c] = tmp;
                    }
                    // show required message with the actual row number used for the swap
                    showMessage(`first row has been swapped with ${r + 1} row`);
                    // update inputs grid if present
                    for (let i = 0; i < matrix.length; i++) {
                        for (let j = 0; j < matrix[i].length; j++) {
                            const inp = document.getElementById(`elem_${i}_${j}`);
                            if (inp) inp.value = matrix[i][j];
                        }
                    }
                    displayMatrixInteractive();
                    return;
                }
            }
            showMessage('No suitable row found to swap with the first row');
        }

        // attach new event listeners
        document.getElementById('step1Btn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                checkFirstElement();
            } catch (e) {
                showMessage(e.message);
            }
        });

        document.getElementById('step3Btn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                swapRowsStep3();
            } catch (e) {
                showMessage(e.message);
            }
        });

        // keep existing "Step One" behavior (highlight first column only, do NOT change first row color)
        document.getElementById('stepOneBtn').addEventListener('click', () => {
            try {
                if (document.querySelector('#inputsArea input')) readMatrixFromInputs();
                if (!matrix || !matrix.length) { showMessage('No matrix available'); return; }

                // find first column (left to right) that has any non-zero value
                const cols = matrix[0].length;
                let foundCol = -1;
                for (let c = 0; c < cols; c++) {
                    let anyNonZero = false;
                    for (let r = 0; r < matrix.length; r++) {
                        if (matrix[r][c] !== 0) { anyNonZero = true; break; }
                    }
                    if (anyNonZero) { foundCol = c; break; }
                }

                // ensure the matrix is displayed
                displayMatrixInteractive();

                // highlight the FIRST COLUMN only (index 0) but do NOT change the first row's cell color
                const displayTbl = document.querySelector('#displayArea table');
                if (displayTbl) {
                    // clear any inline backgrounds first
                    Array.from(displayTbl.querySelectorAll('td')).forEach(td => td.style.background = '');
                    // color the first column cells except the first row
                    Array.from(displayTbl.querySelectorAll('tr')).forEach((tr, rIdx) => {
                        const cell = tr.children[0];
                        if (cell && rIdx !== 0) {
                            cell.style.background = '#c8e6c9';
                        }
                    });
                }

                if (foundCol >= 0) {
                    showMessage("so this is the first un-zero column (column " + (foundCol + 1) + ")");
                } else {
                    showMessage("No non-zero column found");
                }
            } catch (e) {
                showMessage(e.message);
            }
        });
        document.getElementById('createBtn').click();
        function scaleFirstRowByInverse() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) {
                showMessage('Matrix is empty or malformed');
                return;
            }

            const pivot = matrix[0][0];
            if (pivot === 0) {
                showMessage("Cannot scale first row: leading element is zero.");
                return;
            }

            const cols = matrix[0].length;
            for (let c = 0; c < cols; c++) {
                matrix[0][c] = matrix[0][c] / pivot;
            }

            // Update input fields if present
            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[i].length; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }

            displayMatrixInteractive();
            showMessage(`First row scaled by 1/${pivot}`);
        }
        function step6ProcessA22() {
            clearMessages();
            if (!matrix || matrix.length < 2 || matrix[0].length < 2) {
                showMessage('Matrix must be at least 2×2 to process a₂₂');
                return;
            }

            const lastRowIdx = matrix.length - 1;

            // Check for any row that is all zeros
            for (let r = 0; r < matrix.length; r++) {
                const isZeroRow = matrix[r].every(val => val === 0);
                if (isZeroRow && r !== lastRowIdx) {
                    showMessage(`The row number ${r + 1} can't be equal to zero, so please go to Step 3 to swap it with the last row.`);
                    return;
                }
            }

            const pivot = matrix[1][1];
            if (pivot === 0) {
                let swapped = false;
                for (let r = 2; r < matrix.length; r++) {
                    if (matrix[r][1] !== 0) {
                        showMessage(`a₂₂ is zero. Please go to Step 3 to swap row 2 with row ${r + 1}.`);
                        return;
                    }
                }
                showMessage('No suitable row found to swap with row 2 for non-zero a₂₂');
                return;
            }

            const cols = matrix[0].length;

            // Step 4: Scale row 2
            for (let c = 0; c < cols; c++) {
                matrix[1][c] = matrix[1][c] / pivot;
            }

            // Step 5: Zero out column 2 below row 2
            for (let r = 2; r < matrix.length; r++) {
                const factor = -matrix[r][1];
                for (let c = 0; c < cols; c++) {
                    matrix[r][c] += factor * matrix[1][c];
                }
            }

            // Update input fields
            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[i].length; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }

            displayMatrixInteractive();
            showMessage('Step 6 completed: processed a₂₂ through steps 2–5');
        }
        function swapRowsStep3() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) {
                showMessage('Matrix is empty or malformed');
                return;
            }

            const rows = matrix.length;
            const cols = matrix[0].length;
            const lastRowIdx = rows - 1;

            // First: check for any row (except last) that is all zeros
            for (let r = 0; r < lastRowIdx; r++) {
                const isZeroRow = matrix[r].every(val => val === 0);
                if (isZeroRow) {
                    // Swap with last row
                    const temp = matrix[r];
                    matrix[r] = matrix[lastRowIdx];
                    matrix[lastRowIdx] = temp;

                    showMessage(`Row ${r + 1} was all zeros and has been swapped with the last row (${lastRowIdx + 1})`);

                    // Update input fields
                    for (let i = 0; i < rows; i++) {
                        for (let j = 0; j < cols; j++) {
                            const inp = document.getElementById(`elem_${i}_${j}`);
                            if (inp) inp.value = matrix[i][j];
                        }
                    }

                    displayMatrixInteractive();
                    return;
                }
            }

            // If no zero row found, proceed with normal swap logic
            for (let r = 1; r < rows; r++) {
                if (matrix[r][0] !== 0) {
                    for (let c = 0; c < cols; c++) {
                        const tmp = matrix[0][c];
                        matrix[0][c] = matrix[r][c];
                        matrix[r][c] = tmp;
                    }

                    showMessage(`First row has been swapped with row ${r + 1}`);

                    for (let i = 0; i < rows; i++) {
                        for (let j = 0; j < cols; j++) {
                            const inp = document.getElementById(`elem_${i}_${j}`);
                            if (inp) inp.value = matrix[i][j];
                        }
                    }

                    displayMatrixInteractive();
                    return;
                }
            }

            showMessage('No suitable row found to swap with the first row');
        }
        function solveXYZ() {
            clearMessages();

            if (!matrix || matrix.length < 2 || matrix[0].length < 3) {
                showMessage('Matrix must be at least 3×4 (augmented) to solve for x, y, z');
                return;
            }

            // Check for any fully zero row
            const hasZeroRow = matrix.some(row => row.every(val => val === 0));

            // If z doesn't exist or there's a zero row, compute x and y only
            if (matrix.length < 3 || matrix[0].length < 4 || hasZeroRow) {
                try {
                    const [row1, row2] = matrix;
                    const y = row2[3] / row2[1];
                    const x = (row1[3] - row1[1] * y) / row1[0];

                    if (!Number.isFinite(x) || !Number.isFinite(y)) {
                        showMessage('Cannot solve for x and y: matrix may not be in row-echelon form or has invalid values');
                        return;
                    }

                    showMessage(`Partial solution:\n x = ${x.toFixed(3)}\n y = ${y.toFixed(3)}\n z is undefined or skipped`);
                } catch (e) {
                    showMessage('Error computing x and y: ' + e.message);
                }
                return;
            }

            // Full solution for x, y, z
            try {
                const [row1, row2, row3] = matrix;
                const z = row3[3] / row3[2];
                const y = (row2[3] - row2[2] * z) / row2[1];
                const x = (row1[3] - row1[2] * z - row1[1] * y) / row1[0];

                if (!Number.isFinite(x) || !Number.isFinite(y) || !Number.isFinite(z)) {
                    showMessage('Cannot solve: matrix may not be in row-echelon form or has invalid values');
                    return;
                }

                showMessage(`Solution found:\n x = ${x.toFixed(3)}\n y = ${y.toFixed(3)}\n z = ${z.toFixed(3)}`);
            } catch (e) {
                showMessage('Error computing full solution: ' + e.message);
            }
        }
        function swapRowsStep3() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) {
                showMessage('Matrix is empty or malformed');
                return;
            }

            const rows = matrix.length;
            const cols = matrix[0].length;
            const lastRowIdx = rows - 1;

            // First: check for any row (except last) that is all zeros
            for (let r = 0; r < lastRowIdx; r++) {
                const isZeroRow = matrix[r].every(val => val === 0);
                if (isZeroRow) {
                    const temp = matrix[r];
                    matrix[r] = matrix[lastRowIdx];
                    matrix[lastRowIdx] = temp;

                    showMessage(`Row ${r + 1} was all zeros and has been swapped with the last row (${lastRowIdx + 1})`);
                    updateInputsAndDisplay();
                    return;
                }
            }

            // NEW CONDITION: if a22 is zero, swap row 2 with last row
            if (matrix.length >= 2 && matrix[0].length >= 2 && matrix[1][1] === 0) {
                const temp = matrix[1];
                matrix[1] = matrix[lastRowIdx];
                matrix[lastRowIdx] = temp;

                showMessage(`a₂₂ was zero, so row 2 has been swapped with the last row (${lastRowIdx + 1})`);
                updateInputsAndDisplay();
                return;
            }

            // Default behavior: swap first row with any row that has non-zero in column 1
            for (let r = 1; r < rows; r++) {
                if (matrix[r][0] !== 0) {
                    for (let c = 0; c < cols; c++) {
                        const tmp = matrix[0][c];
                        matrix[0][c] = matrix[r][c];
                        matrix[r][c] = tmp;
                    }

                    showMessage(`First row has been swapped with row ${r + 1}`);
                    updateInputsAndDisplay();
                    return;
                }
            }

            showMessage('No suitable row found to swap with the first row');
        }

        // Helper to update input fields and display
        function updateInputsAndDisplay() {
            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[i].length; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }
            displayMatrixInteractive();
        }
        function step6ProcessA22() {
            clearMessages();
            if (!matrix || matrix.length < 3 || matrix[0].length < 3) {
                showMessage('Matrix must be at least 3×3 to process a₂₂ with extended conditions');
                return;
            }

            const a22 = matrix[1][1];
            const a12 = matrix[0][1];
            const a32 = matrix[2][1];

            // Check for special conditions
            if (a22 === 0 && a12 === 0 && a32 !== 0) {
                showMessage("The element a₂₂ = 0. To continue, go to Step 3 to swap the second row with the last row.");
                return;
            }
            const lastRowIdx = matrix.length - 1;
            // Check for any row that is all zeros
            for (let r = 0; r < matrix.length; r++) {
                const isZeroRow = matrix[r].every(val => val === 0);
                if (isZeroRow && r !== lastRowIdx) {
                    showMessage(`The row number ${r + 1} can't be equal to zero, so please go to Step 3 to swap it with the last row.`);
                    return;
                }
            }

            // Proceed with normal pivot check and elimination
            if (a22 === 0) {
                for (let r = 2; r < matrix.length; r++) {
                    if (matrix[r][1] !== 0) {
                        showMessage(`a₂₂ is zero. Please go to Step 3 to swap row 2 with row ${r + 1}.`);
                        return;
                    }
                }
                showMessage('No suitable row found to swap with row 2 for non-zero a₂₂');
                return;
            }

            // Step 4: Scale row 2
            for (let c = 0; c < matrix[0].length; c++) {
                matrix[1][c] = matrix[1][c] / a22;
            }

            // Step 5: Zero out column 2 below row 2
            for (let r = 2; r < matrix.length; r++) {
                const factor = -matrix[r][1];
                for (let c = 0; c < matrix[0].length; c++) {
                    matrix[r][c] += factor * matrix[1][c];
                }
            }

            // Update input fields
            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[i].length; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }

            displayMatrixInteractive();
            showMessage('Step 6 completed: processed a₂₂ through steps 2–5');
        }
        function zeroOutFirstColumn() {
            clearMessages();
            if (!matrix || !matrix.length || !matrix[0]) {
                showMessage('Matrix is empty or malformed');
                return;
            }

            const rows = matrix.length;
            const cols = matrix[0].length;
            const a11 = matrix[0][0];

            if (a11 === 0) {
                showMessage("The leading (a₁₁) is zero. Cannot proceed with elimination.");
                return;
            }

            let actions = [];

            // Eliminate entries below a₁₁ in column 1
            for (let r = 1; r < rows; r++) {
                const a_r1 = matrix[r][0];
                if (a_r1 === 0) continue;

                const factor = a_r1 / a11;
                for (let c = 0; c < cols; c++) {
                    matrix[r][c] -= factor * matrix[0][c];
                }

                actions.push(`Row ${r + 1} updated: subtracted (${factor.toFixed(3)}) × Row 1`);
            }

            // Update input fields
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const inp = document.getElementById(`elem_${i}_${j}`);
                    if (inp) inp.value = matrix[i][j];
                }
            }

            displayMatrixInteractive();
            showMessage(actions.length ? actions.join('\n') : "No changes needed. First column already zeroed below pivot.");
        }
        function JordanElimination() {
            clearMessages();
            if (!matrix || matrix.length < 3 || matrix[0].length < 4) {
                showMessage('Matrix must be at least 3×4 for Jordan elimination');
                return;
            }

            const rows = matrix.length;
            const cols = matrix[0].length;
            let actions = [];

            // Step 1: Eliminate column 2 (zero all except a₂₂)
            const pivot2 = matrix[1][1];
            if (pivot2 === 0) {
                showMessage('Cannot eliminate column 2: pivot a₂₂ is zero');
                return;
            }

            for (let r = 0; r < rows; r++) {
                if (r === 1) continue; // skip pivot row
                const factor = matrix[r][1] / pivot2;
                for (let c = 0; c < cols; c++) {
                    matrix[r][c] -= factor * matrix[1][c];
                }
                actions.push(`Row ${r + 1} updated: subtracted (${factor.toFixed(3)}) × Row 2`);
            }

            // Step 2: Clean row 3 — zero all except a₃₃
            const pivot3 = matrix[2][2];
            if (pivot3 === 0) {
                showMessage('Cannot process third row: pivot a₃₃ is zero');
                updateInputsAndDisplay();
                return;
            }

            for (let c = 0; c < cols; c++) {
                if (c !== 2) {
                    matrix[2][c] = 0;
                }
            }
            actions.push('Row 3 cleaned: all elements zero except a₃₃');

            // Step 3: Scale a₃₃ to 1
            matrix[2][2] = 1;
            actions.push('Row 3 pivot scaled to 1');

            // Step 4: Eliminate column 3 (zero all except a₃₃)
            for (let r = 0; r < rows; r++) {
                if (r === 2) continue; // skip pivot row
                const factor = matrix[r][2];
                for (let c = 0; c < cols; c++) {
                    matrix[r][c] -= factor * matrix[2][c];
                }
                actions.push(`Row ${r + 1} updated: subtracted (${factor.toFixed(3)}) × Row 3`);
            }

            updateInputsAndDisplay();
            showMessage(actions.join('\n'));
        }

    </script>
</body>

</html>